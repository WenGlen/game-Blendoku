/* ================ reset ================ */

html, body, div, span, applet, object, iframe,
h1, h2, h3, h4, h5, h6, p, blockquote, pre,
a, abbr, acronym, address, big, cite, code,
del, dfn, em, img, ins, kbd, q, s, samp,
small, strike, strong, sub, sup, tt, var,
b, u, i, center,
dl, dt, dd, ol, ul, li,
fieldset, form, label, legend,
table, caption, tbody, tfoot, thead, tr, th, td,
article, aside, canvas, details, embed,
figure, figcaption, footer, header, hgroup,
menu, nav, output, ruby, section, summary,
time, mark, audio, video {
  margin: 0;
  padding: 0;
  border: 0;

  font: inherit;
  font-size: 100%;
  vertical-align: baseline;
}

article, aside, details, figcaption, figure,
footer, header, hgroup, menu, nav, section {
  display: block;
}

body {
  line-height: 1;
}

ol, ul {
  margin: 0;
  padding-left: 32px;
}

blockquote, q { quotes: none; }

blockquote:before, blockquote:after,
q:before, q:after { content: ''; }

table {
  border-collapse: collapse;
  border-spacing: 0;
}

/* ================ tokens ================ */
:root {
  /* frame */
  --radius: 8px;

  --button-size: 32px;
  --button-radius: 8px;
  --button-font-size: 8px;

  --grid-size: 60px;
  --grid-radius: 8px;

  /* text */
  --font-size-h1: 10vh;
  --font-size-h2: 20px;
  --font-size-h3: 14px;
  --font-size-body: 12px;
  --font-size-small: 12px;

  /* color */
  --color-primary: #0a88a3;
  --color-primary2: #004d99;
  --color-primary-light: #39abbd;
  --color-secondary: #ffbf00;
  --color-secondary2: #ffd300;
  --color-warning: #ff80bf;
  --color-temp: #666;

  --color-gray: #5f7791;
  --color-gray90: #202830;
  --color-gray80: #303c49;
  --color-gray70: #3f4f61;
  --color-gray60: #4f6379;
  --color-gray50: #5f7791;
  --color-gray40: #7a8ea3;
  --color-gray30: #94a4b6;
  --color-gray20: #afbbc8;
  --color-gray10: #e4e8ed;
  --color-gray05: #e4e8ed;

  --color-bg-dark: var(--color-gray90);
  --color-container-dark: var(--color-gray70);

  --color-bg-light: #f5f5dc;
  --color-container-light: #264c58;

  --color-border: #5e86c1;

}



// ================ main ================ //

* {
  box-sizing: border-box;
}

html, body {
  overflow: hidden;

  height: 100%;
  margin: 0;

  background: var(--color-bg-dark);
}

.wrap { // border: 1px solid var(--color-temp);
  overflow: hidden;
  position: relative;
  display: flex;
  flex-direction: column;

  max-width: 50vh;
  height: 100vh;
  margin: 0 auto;
  padding: 2vh;

}

button {
  margin: 0 1vh;
  padding: 1vh 3vh;

  border: 0;
  border-radius: var(--radius);
  background: var(--color-gray10);
  cursor: pointer;

  font-size: 2vh;

  color: var(--color-gray90);
}


.hidden { display: none !important; }

// ================ header ================ //
.header{ //border: 1px solid var(--color-temp);
 display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  align-items: center;

  width: 100%;
  height: 8vh;
  margin: 0 auto 2vh;

  background: var(--color-container-dark);
  border-radius: var(--radius);
  
 .logo { // border: 1px solid var(--color-temp);
    width: 4vh;
    height: 4vh;
    margin: 2vh;

    img {
      width: 100%;
      height: auto;
    }
  }

 .levelNum {
    font-family: monospace;
    font-size: 4vh;
    font-weight: bold;
    line-height: 1.5;
    text-align: center;

    color: var(--color-gray20);
  }

}



.icon-btn2{
  background: transparent;
  width: 4vh;
  height: 4vh;
  padding: 0;
  margin: 2vh;
  img {
    width: 100%;
    height: auto;
  }
}

.homeIcon{
  opacity: 0.5;
  cursor: pointer;

  &:hover{opacity: 0.7;}
}


// ================ content ================ //

.panel{
  position: relative;
  display: flex;
  flex-direction: column;
  flex-grow: 1;

  width: 100%;
  margin: 0 auto;
  padding: 4vh;

  background: var(--color-container-dark);
  border-radius: var(--radius);
}

/* ================ panel UI ================ */

.grid-board {
  display: grid;
  justify-content: center;
}

.start-board {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
}

.fixed-tile {
  cursor: not-allowed;
}

.cell {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;

  width: var(--grid-size);
  height: var(--grid-size);

  border: 1px solid var(--color-gray70);
  border-radius: var(--grid-radius);

  background: var(--color-gray90);

  &.fixed::after {//Êîæ‰∏ä‰∏äÈéñÁöÑÂúñ
    position: absolute;
    top: 4px;
    right: 4px;

    font-size: 14px;

    opacity: 0.7;

    content: "üîí";
  }
  
  &.hidden-cell {
  background-color: var(--color-container-dark);

  pointer-events: none; /* ÁÑ°Ê≥ïÊãñÊõ≥ÈÄ≤ÂÖ• */
  }

}



.tile {
  width: var(--grid-size);
  height: var(--grid-size);

  border-radius: var(--grid-radius);

  cursor: grab;
}



.gap-line {
  height: 2px;
  margin: 4vh 0;

  background: var(--color-gray60);
}

.gap-space {
  flex-grow: 1;

  width: 100%;
}

.info-bar {
  display: flex;
  justify-content: space-between;

  margin-top: 2vh;
  margin-bottom: -1vh;
  padding: 1vh;

  border-radius: var(--radius);
  background: var(--color-gray80);

  font-size: 1.5vh;

  color: var(--color-gray20);
}


.counter {
  display: inline-block;

  width: var(--counter-w, auto);

  text-align: right;
  font-family: monospace;
}

#step-count {
  --counter-w: 30px;
}

#timer {
  --counter-w: 60px;
}

/* ================ Start Screen ================ */
#main-menu {
  position: absolute;
  inset: 2vh;                /* ÊØî top/left/width/height Êõ¥Á∞°ÊΩî */
  box-sizing: border-box;
  z-index: 200;         /* ÊèêÈ´òÂ±§Á¥öÔºåÁ©©Á©©Ëìã‰Ωè‰∏ÄÂàá */

  width: 100%;
  flex-grow: 1;
	margin: 0 auto;
  padding: 4vh;

  background: var(--color-container-dark);
  border-radius: var(--radius);

  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  h1 {color: var(--color-gray10);font-size: var(--font-size-h1);}
  gap: 2vh;

}

/* ‰∏ªÂãï‰ΩúÂàóÔºöÂÖ©È°ÜÂ§ßÊåâÈàï */
.menu-actions{
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin: 16px 0 20px;
}

/* ÈóúÂç° 3x3 Á∂≤Ê†º */
.level-grid{
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
}

/* ÈÄöÁî®ÊåâÈàï */
.btn {
  //padding: 2vh;
  //border-radius: var(--button-radius);
  //border: 1px solid transparent;
  //text-align: center;
  

  color: var(--color-gray90);
  background: var(--color-gray10);

  &.primary {
  background: var(--color-primary);
  color: var(--color-gray10);
  font-weight: bold;
  
  &:hover{
    background: var(--color-primary-light);
  }
  }

  &.ghost {
  background: transparent;
  border-color: var(--color-gray30);
  color: var(--color-gray20);
  }
  
}


/* ÈóúÂç°ÊåâÈàï */
.level-btn{
  padding: 2vh;
  border-radius: var(--button-radius);
  background: var(--color-gray60);
  color: var(--color-gray20);
  font-weight: bold;
}
.level-btn:hover{ background: var(--color-gray50); }
.level-btn:disabled{
  opacity: .5;
  cursor: not-allowed;
}


/* ================ popup ================ */
.popup {
  position: fixed;

  top: 0;
  left: 0;
  width: 100%;
  height: 100%;

  background: rgba(0,0,0,0.4);

  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 100;
}

.popup-content {
  padding: 4vh;
  border-radius: var(--radius);

  background: var(--color-gray70);

  text-align: center;
  line-height: 1;


  h3 {
    color: var(--color-gray10);
    font-size: 3vh;
    line-height: 1.5;
  }

  &.pass-record {
    height: 2vh;
    display: flex;
    justify-content: space-around;
    align-items: center;

    color: var(--color-gray30);
    font-size: 1.5vh; 
  }

}


// ================ footer ================ //
.footer{
  box-sizing: border-box;
  width: 100%;
  height: 4vh;
  margin-top: 2vh;
  padding: 1vh 2vh;
  
	background-color: var(--color-container-dark);
  border-radius: var(--radius);

  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;

	p{
		font-size: 12px;
		color: var(--color-gray40);
		text-align: center;
	}

}

// ================ Overlay shell ================ //

.overlay {
  position: absolute; inset: 0;
  z-index: 300;
  display: flex; align-items: center; justify-content: center;
  background: rgba(0,0,0,.5);
}

.tutorial-card {
  position: absolute;
  inset: 2vh;                /* ÊØî top/left/width/height Êõ¥Á∞°ÊΩî */
  box-sizing: border-box;
  z-index: 300;         /* ÊèêÈ´òÂ±§Á¥öÔºåÁ©©Á©©Ëìã‰Ωè‰∏ÄÂàá */

  width: 100%;
  flex-grow: 1;
	margin: 0 auto;
  padding: 25vh 4vh;

  background: var(--color-container-dark);
  border-radius: var(--radius);
  color: var(--color-gray10);
  display: flex; flex-direction: column; gap: 1.6vh;
}

.tutorial-header { display:flex; justify-content:space-between; align-items:center; margin-bottom: 2vh; }
.tutorial-title { font-size: 2.4vh; font-weight: bold;}
.icon-btn { background: transparent; border: 0; color: var(--color-gray30); font-size: 20px; cursor: pointer; padding:0 ;}

.tutorial-body { min-height: 28vh; }
.t-step { display: none; }
.t-step.active { display: block; }
.t-step h3 { font-size: 2.2vh; margin-bottom: .8vh; color: var(--color-gray10); }
.t-step p  { font-size: 1.6vh; color: var(--color-gray20); margin-bottom: 1.4vh; }

.tutorial-footer { display:flex; justify-content: space-between; align-items:center; }
.dots { display:flex; gap: 8px; }
.dots .dot { width: 8px; height: 8px; border-radius: 50%; background: var(--color-gray50); opacity:.5; }
.dots .dot.active { opacity:1; background: var(--color-secondary); }

.demo { 
  //border: 1px dashed var(--color-gray60);
  border-radius: var(--radius);
  padding: 1.2vh;
}

:root {
  --gap: 8px;
  --grid-size: 60px;
  --grid-radius: 8px; 
  --step: calc(var(--grid-size) + var(--gap));

}

/* ÂÖ±Áî®Â∞èÊ†º */
.grid { display:grid; grid-template-columns: repeat(3, var(--grid-size)); gap: 8px; justify-content:center; }
.cell {
  display:flex; align-items:center; justify-content:center;
  width: var(--grid-size); height: var(--grid-size);
  background: var(--color-gray90); border: 1px solid var(--color-gray70); border-radius: var(--grid-radius);
}
.cell.empty { background: transparent; border-style: dashed; }
.tile { width: var(--grid-size); height: var(--grid-size); border-radius: var(--grid-radius); }

.demo-panel {
padding: 2vh;

}

.cursor-hand {
  position: absolute;
  transition: none; // Á¶ÅÊ≠¢‰ªª‰ΩïÊº∏ËÆä
  pointer-events: none; // Èò≤Ê≠¢Ê∏∏Ê®ôÂúñÊìãÂà∞‰∫ã‰ª∂
}

/* ===== Step 1 ÊïôÂ≠∏ÊèíÂúñÔºö2Ë°å4Ê†ºÊº∏Â±§Á§∫ÊÑè  ===== */
.demo-gradients {
  display: flex;
  flex-direction: column;
  gap: 3vh; // ÂÖ©Ë°å‰πãÈñìÈñìË∑ù

  .grid {
    display: flex;
    gap: 0vh; // Ëâ≤Â°äÈñìË∑ù
  }

  // ‰æùÈ†ÜÂ∫èÂ•óÈ°èËâ≤
  .tile.color1 { background: #0c6b00; }
  .tile.color2 { background: #4d8f13; }
  .tile.color3 { background: #86a927; }
  .tile.color4 { background: #ffe14d; }
  .tile.color5 { background: #004d99; }
  .tile.color6 { background: #007ba7; }
  .tile.color7 { background: #76bad3; }
  .tile.color8 { background: #ebf9ff; }
}

/* ===== Step 2ÔºöÊãøËµ∑ÔºèÊîæ‰∏ãÔºèÁßªÂãïÔºàÂÆåÊï¥ 1‚Üí6 ÊµÅÁ®ãÔºâ ===== */


$S2_DUR: 5s;                /* ÂÖ®ÊÆµÂãïÁï´Èï∑Â∫¶ÔºàÂèØË™øÔºâ */
$S2_MOVE_SLICE: 10%;      /* 5s ÁöÑ 0.5s ‚âà 10% */

/* ÊôÇÈñìÁâáÊÆµÔºàÁôæÂàÜÊØîÔºâ */
$grab1_start: 10%;  $grab1_end: 25%;   /* (2) ÊäìËµ∑‰∏≠ÈñìÔºötile ‰∏äÊµÆ */
$moveR_start: 40%;  $moveR_end: 48%;   /* (4) ÂæÄÂè≥Áßª 0.5s */
$grab2_start: 65%;  $grab2_end: 80%;   /* (5) Âè≥Ê†ºÊäìÂèñÔºàfixedÔºå‰∏ç‰∏äÊµÆÔºâ */
$moveL_start: 90%;  $moveL_end: 98%;   /* (6) ÂæÄÂ∑¶ÁßªÂõû 0.5s */

.pick-scene {
  --gap: 8px;
  --step: calc(var(--grid-size) + var(--gap)); /* ‰∏ÄÊ†ºÁöÑ‰ΩçÁßªË∑ùÈõ¢ */
  position: relative;                           /* Ê∏∏Ê®ôÂÆö‰ΩçÂèÉËÄÉ */
}

/* ËÆì‰∏âÈ°ÜÁ§∫ÊÑèËâ≤Â°äÂ•ΩËæ®Ë≠òÔºàÂèØ‰æù‰Ω†‰∏ªÈ°åË™øÊï¥Ëâ≤Ôºâ */
.pick-t1 { background: var(--color-gray90); }
.pick-t2 { background: #86a927; }
.pick-t3 { background: #ffe14d; }

/* ‰∏≠ÈñìÈÇ£È°ÜÂú®ÊäìÂèñÊúüÈñì‰∏äÊµÆÔºàÂè™Âú® grab1 ÊúüÈñì‰ΩúÂãïÔºâ */
.pick-scene .mid .tile {
  animation: s2-lift $S2_DUR ease-in-out infinite;
  transform-origin: center;
}
@keyframes s2-lift {
  0%, #{ $grab1_start - 0.01% }     { transform: translateY(0); box-shadow: none; }
  #{$grab1_start}, #{$grab1_end}    { transform: translateY(-12px); box-shadow: 0 8px 16px rgba(0,0,0,.35); }
  #{$grab1_end + 0.01%}, 100%       { transform: translateY(0); box-shadow: none; }
}

/* Ê∏∏Ê®ôÂü∫Ê∫ñ‰ΩçÁΩÆÔºö‰∏ÄÈñãÂßãÂú®„Äå‰∏≠ÈñìÊ†º„ÄçÂè≥‰∏ãËßí */
.pick-scene .cursor-hand {
  position: absolute;
  z-index: 10;                /* Ê∞∏ÈÅ†ÊµÆÂú® tile ‰πã‰∏ä */
  width: 28px;
  pointer-events: none;
  left: calc(var(--grid-size) * 3 + var(--gap) * 2 ); /* ‰æù‰Ω†ÁöÑÊ†ºÊï∏ÂæÆË™ø */
  //top:  calc(0.4 * var(--grid-size));
  transition: none !important; /* Á¶ÅÁî®‰ªª‰Ωï transition ÈÅøÂÖçÊº∏ËÆä */
}

/* ===== Ê∏∏Ê®ô„ÄåÈ°ØÁ§∫ÁãÄÊÖã„ÄçÔºöÁû¨ÂàáÔºàopacity stepsÔºâ ===== */
/* idleÔºöÈô§‰∫ÜÂÖ©ÊÆµÊäìÂèñÊúüÈñìÂ§ñÔºåÂÖ∂È§òÊôÇÊÆµÈ°ØÁ§∫ */
@keyframes s2-cursor-idle {
  0%, #{ $grab1_start - 0.01% }     { opacity: 1; }
  #{$grab1_start}, #{$grab1_end}    { opacity: 0; }   /* ÊäìËµ∑‰∏≠Èñì */
  #{$grab1_end + 0.01% }, #{ $grab2_start - 0.01% } { opacity: 1; }
  #{$grab2_start}, #{$grab2_end}    { opacity: 0; }   /* Âè≥Ê†ºÊäìÂèñÔºàfixedÔºâ */
  #{$grab2_end + 0.01%}, 100%       { opacity: 1; }
}
/* grabbingÔºöËàá idle ‰∫íË£ú */
@keyframes s2-cursor-grab {
  0%, #{ $grab1_start - 0.01% }     { opacity: 0; }
  #{$grab1_start}, #{$grab1_end}    { opacity: 1; }
  #{$grab1_end + 0.01% }, #{ $grab2_start - 0.01% } { opacity: 0; }
  #{$grab2_start}, #{$grab2_end}    { opacity: 1; }
  #{$grab2_end + 0.01%}, 100%       { opacity: 0; }
}

/* ===== Ê∏∏Ê®ô„Äå‰ΩçÁΩÆ„ÄçÔºö‰∏≠ ‚Üí Âè≥ ‚Üí Âõû‰∏≠ÔºàÂÖ©ÊÆµÂêÑ ~0.5sÔºâ ===== */
@keyframes s2-move {
  /* Ëµ∑ÈªûÂú®‰∏≠ÈñìÔºàtranslateX(0)Ôºâ */
  0%, #{ $moveR_start - 0.01% }     { transform: translateX(0); }
  #{$moveR_end}                     { transform: translateX(var(--step)); } /* Âè≥Áßª‰∏ÄÊ†º */
  #{$grab2_end}, #{ $moveL_start - 0.01% } { transform: translateX(var(--step)); }
  #{$moveL_end}                     { transform: translateX(0); }           /* ÁßªÂõû‰∏≠Èñì */
  100%                              { transform: translateX(0); }
}

/* Â•óÁî®Âà∞ÂÖ©ÂºµÊ∏∏Ê®ôÂúñÔºö‰∏ÄÂºµÁÆ°ÂèØË¶ñ„ÄÅ‰∏ÄÂºµÁÆ°‰∏çÂèØË¶ñÔºõ‰ΩçÁΩÆÂÖ±Áî® s2-move */
.pick-scene .cursor-hand.idle {
  animation: s2-cursor-idle $S2_DUR steps(1, end) infinite,
             s2-move        $S2_DUR linear         infinite;
}
.pick-scene .cursor-hand.grabbing {
  animation: s2-cursor-grab $S2_DUR steps(1, end) infinite,
             s2-move        $S2_DUR linear         infinite;
}




/* ===== Step 3Ôºö‰∫§ÊèõÁ§∫ÊÑèÔºàÊ∏∏Ê®ôË∑ØÂæë + A/B ‰∫§ÊèõÔºâ ===== */

/* ===== Step 3ÔºöÂõõÊ†º‰∫§ÊèõÔºàÂêåÊ≠• + ÊäìÂèñÁãÄÊÖã + Áû¨ÂàáÈáçÁΩÆÔºâ===== */

$S3_DUR: 5s;
$PAUSE_S: (0.5s / $S3_DUR) * 100%;
$PAUSE_L: (0.5s   / $S3_DUR) * 100%;

/* ÁØÄÈªûÔºàÂ¶ÇË¶ÅË™øÈÄüÂè™ÊîπÈÄô‰∫õÔºâ */
$P1: 10%;         /* Ëµ∑ÂßãÂÅú‰ΩèÔºàÊú™ÊäìÔºâ */
$P2: 10.01%;         /* Êäì1ÈñãÂßãÔºöA ‰∏äÊµÆ */
$P3: 40%;         /* ÁßªÂãï 1‚Üí3 ÂÆåÊàê */
$P4: 40.01%;         /* Êîæ‰∏ãÂà∞Á¨¨3Ê†º */
$P5S: $P4 + $PAUSE_S;   /* Á≠â 0.5s */
$P5E: $P5S + 0.01%;        /* Êäì2ÁµêÊùüÔºà‰∏äÊµÆÂÆåÊàêÔºâ */
$P6E: 70%;              /* ÁßªÂãï 3‚Üí4 ÂÆåÊàê */
$P7S: 70%;             /* ÂÅúÂú®Á¨¨4Ê†ºÔºàÊäìËëóÔºâ */
$P7_RELEASE: 70.1%  ; /* 0.5s ÂæåÊîæ‰∏ãÔºöA ËêΩÁ¨¨4„ÄÅB Áû¨Âà∞Á¨¨3 */
$RESET_AT: 99.9999%; /* 1s ÂæåÈáçÁΩÆÁû¨Âàá */

.demo-step3 .swap-scene{
  --gap: 8px;
  --step: calc(var(--grid-size) + var(--gap));
  display: grid;
  grid-template-columns: repeat(4, var(--grid-size));
  gap: var(--gap);
  justify-content: center;
  position: relative;
}

/* Â±§Á¥öÔºöcursor > A > B */
.demo-step3 .tile      { position: relative; z-index: 1; }
.demo-step3 .tile-a    { z-index: 3; will-change: transform; background:#0c6b00; }
.demo-step3 .tile-b    { z-index: 2; background:#ffe14d; }

/* ÈÅøÂÖçËàäË¶èÂâáÊää‰∏ÄÂºµÂúñ display:noneÔºõÂÖ©ÂºµÈÉΩÈ°ØÁ§∫ÔºåÁî® opacity ÂàáÊèõ */
.demo-step3 .cursor-hand { display:block !important; }

/* Ê∏∏Ê®ôÂü∫Ê∫ñÔºàÁ¨¨1Ê†ºÂè≥‰∏ãÔºâ */
.demo-step3 .cursor-hand{
  position:absolute; z-index:4; pointer-events:none; width:28px;
  left: calc(0 * var(--step) + 1 * var(--grid-size));
  //top:  calc(0.72 * var(--grid-size));
  transition: none !important;
}

/* ===== Ê∏∏Ê®ôÈ°ØÁ§∫ÁãÄÊÖãÔºàÁßªÂãïÂÖ®Á®ãÁÇ∫ grabÔºâ===== */
@keyframes s3-cursor-idle {
  /* Êú™ÊäìÈ°ØÁ§∫ÔºåÊäì/ÁßªÂãïÈö±Ëóè */
  0%, #{$P1}                         { opacity:1; }
  #{$P1 + 0.01%}, #{$P4}             { opacity:0; }   /* Êäì1 + ÁßªÂãï1‚Üí3 + Êîæ‰∏ãÈÅéÁ®ã */
  #{$P4 + 0.01%}, #{$P5S}            { opacity:1; }   /* Á≠â0.5s */
  #{$P5S + 0.01%}, #{$P7_RELEASE}    { opacity:0; }   /* Êäì2 + ÁßªÂãï3‚Üí4 + ÊîæÂâçÂÅú */
  #{$P7_RELEASE + 0.01%}, 100%       { opacity:1; }
}
@keyframes s3-cursor-grab {
  /* ÊäìËàáÁßªÂãïÊúüÈñìÈ°ØÁ§∫ */
  0%, #{$P1}                         { opacity:0; }
  #{$P1 + 0.01%}, #{$P4}             { opacity:1; }   /* Êäì1 + ÁßªÂãï1‚Üí3 + Êîæ‰∏ã‰∫§Êé• */
  #{$P4 + 0.01%}, #{$P5S}            { opacity:0; }   /* Á≠â0.5s */
  #{$P5S + 0.01%}, #{$P7_RELEASE}    { opacity:1; }   /* Êäì2 + ÁßªÂãï3‚Üí4 + ÊîæÂâçÂÅú */
  #{$P7_RELEASE + 0.01%}, 100%       { opacity:0; }
}

/* ÂÖ©ÂºµÊ∏∏Ê®ôÂúñÔºöÂêå‰∏ÄÊ¢ù‰ΩçÁΩÆÂãïÁï´ + Á∑öÊÄßÔºåÂêåÊ≠• */
.demo-step3 .cursor-hand.idle {
  animation: s3-cursor-idle $S3_DUR steps(1,end) infinite,
             s3-move        $S3_DUR linear       infinite !important;
}
.demo-step3 .cursor-hand.grabbing {
  animation: s3-cursor-grab $S3_DUR steps(1,end) infinite,
             s3-move        $S3_DUR linear       infinite !important;
}

/* ===== Ê∏∏Ê®ô‰ΩçÁΩÆÔºàlinearÔºåÂêåÊ≠•ÔºâÔºö1‚Üí3‚Üí4‚Üí(99.99%‰ªç4Ôºå100%Áû¨Âõû1) ===== */
@keyframes s3-move {
  /* Ëµ∑ÈªûÂú®Á¨¨1Ê†º */
  0%, #{$P2 - 0.01%}                { transform: translateX(0); }

  /* ÊäìËµ∑ÂæåÁßªÂãïÂà∞Á¨¨3Ê†ºÔºàÂÆåÊàêÊñº P3Ôºâ */
  #{$P3}                            { transform: translateX(calc(2 * var(--step))); }

  /* ‚úÖ Âú®Á¨¨3Ê†ºÂÅú‰ΩèÔºöÊîæ‰∏ã(P4) ‚Üí Á≠â0.5s(P5S) ‚Üí ÊäìËµ∑ÂÆåÊàê(P5E) ÈÉΩ‰∏çÂãï */
  #{$P4}, #{$P5S}, #{$P5E}          { transform: translateX(calc(2 * var(--step))); }

  /* ÂÜçÁßªÂãïÂà∞Á¨¨4Ê†ºÔºàÂÆåÊàêÊñº P6EÔºâ */
  #{$P6E}                           { transform: translateX(calc(3 * var(--step))); }

  /* Âú®ÈáçÁΩÆÂâçÂÅúÂú®Á¨¨4Ê†ºÔºå100% Áû¨ÂõûÂà∞Á¨¨1Ê†º */
  #{$RESET_AT - 0.01%}              { transform: translateX(calc(3 * var(--step))); }
  100%                              { transform: translateX(0); }
}

/* ===== Á∂†Ëâ≤ AÔºöËàáÊ∏∏Ê®ôÂêåÁØÄÈªûÔºàlinearÔºâÔºåÊäìÊôÇ‰∏äÊµÆÔºåÊúÄÂæåÁû¨ÂàáÂõûËµ∑Èªû ===== */
@keyframes s3-a-path {
  0%, #{$P1}                        { transform: translateX(0) translateY(0); box-shadow:none; }

  /* Êäì1‰∏äÊµÆ */
  #{$P2}                            { transform: translateX(0) translateY(-12px); box-shadow:0 8px 16px rgba(0,0,0,.35); }

  /* ÁßªÂãï 1‚Üí3ÔºàlinearÔºåÂêåÊ≠•Ôºâ */
  #{$P3}                            { transform: translateX(calc(2 * var(--step))) translateY(-12px); }

  /* Êîæ‰∏ãÂà∞Á¨¨3Ê†ºÂ∫ï‰∏¶ÂÅú */
  #{$P4}                            { transform: translateX(calc(2 * var(--step))) translateY(0); box-shadow:none; }
  #{$P5S - 0.01%}                   { transform: translateX(calc(2 * var(--step))) translateY(0); }

  /* Êäì2‰∏äÊµÆÔºàÁ¨¨3Ê†ºÔºâ */
  #{$P5E}                           { transform: translateX(calc(2 * var(--step))) translateY(-12px); box-shadow:none; }

  /* ÁßªÂãï 3‚Üí4ÔºàlinearÔºåÂêåÊ≠•Ôºâ */
  #{$P6E}                           { transform: translateX(calc(3 * var(--step))) translateY(-12px); box-shadow:none; }

  /* Êîæ‰∏ãÂà∞Á¨¨4Ê†ºÂ∫ï‰∏¶Á∂≠ÊåÅÂà∞ÈáçÁΩÆ */
  #{$P7_RELEASE}                    { transform: translateX(calc(3 * var(--step))) translateY(0); box-shadow:none; }

  /* 99.99% ‰ªçÂú®Á¨¨4Ê†ºÔºå100% Áû¨ÂõûÁ¨¨1Ê†º */
  #{$RESET_AT - 0.01%}              { transform: translateX(calc(3 * var(--step))) translateY(0); }
  100%                              { transform: translateX(0) translateY(0); }
}
.demo-step3 .tile-a { animation: s3-a-path $S3_DUR linear infinite !important; }

/* ===== ÈªÉËâ≤ BÔºöÁ¨¨7Ê≠•Áû¨Âà∞Á¨¨3Ê†ºÔºåÈáçÁΩÆÁû¨ÂõûÁ¨¨4Ê†ºÔºàÁî® steps ‰øùË≠âÁû¨ÂàáÔºâ ===== */
@keyframes s3-b-swap {
  0%, #{$P7_RELEASE - 0.01%}        { transform: translateX(0); } /* Âú®Á¨¨4Ê†º */
  #{$P7_RELEASE}, #{$RESET_AT - 0.01%} { transform: translateX(calc(-1 * var(--step))); } /* Áû¨Âà∞Á¨¨3Ê†º */
  100%                              { transform: translateX(0); } /* Áû¨ÂõûÁ¨¨4Ê†º */
}
.demo-step3 .tile-b { animation: s3-b-swap $S3_DUR steps(1,end) infinite !important; }




/* Step 4 ÈÅéÈóúÂãïÁï´ + ÂÅáÂΩàÁ™ó */

/* ===== Step 4Ôºö‰∏ÄÈñãÂßãÊâãÊäìËëóÊúÄÂæå‰∏ÄÈ°Ü ‚Üí ÁßªÂà∞Á¨¨‰∫åÊ†º‰∏äÊñπ ‚Üí Êîæ‰∏ã ‚Üí Âá∫ÁèæÂΩàÁ™ó ‚Üí ÈáçÁΩÆ ===== */

$S4_DUR: 4s;                                 /* üîß ÂÖ®ÊÆµÁ∏ΩÈï∑ */
//$PAUSE_POP: (1s / $S4_DUR) * 100%;           /* ÂΩàÁ™óÈ°ØÁ§∫ 1s Â∞çÊáâÁöÑÁôæÂàÜÊØî */

/* ÊôÇÈñìÁØÄÈªûÔºàÁôæÂàÜÊØîÔºåÁÖßÈúÄÊ±ÇÂ•ΩÊîπÔºâ */
$P_MOVE_END: 40%;         /* (2) ÁßªÂãïÂà∞Á¨¨2Ê†º‰∏äÊñπ ÂÆåÊàê */
$P_DROP:      40.01%;        /* (3) Êîæ‰∏ãÔºàtile-c ÊéâÂÖ•Á¨¨2Ê†ºÔºåÊâãÊîπ idleÔºâ */
$P_POP_S:     40.01%;        /* (4) ÂΩàÁ™óÈ°ØÁ§∫ÈñãÂßã */
$P_POP_E:     99.99%;   /* (4) ÂΩàÁ™óÈ°ØÁ§∫ÁµêÊùü */
$P_RESET:     100%;       /* (5) ÈáçÁΩÆÂà∞ÂàùÂßã */

.demo-step4 {
  position: relative;            /* ‰Ω†Â∑≤Á∂ìÊúâ‰∫ÜÔºå‰øùÁïô */
  --gap: 8px;                    /* ÊèêÂà∞ÈÄôË£° */
  --step: calc(var(--grid-size) + var(--gap));
}
/* ÂõõÊ†ºÂ†¥ÊôØÔºö1„ÄÅ3„ÄÅ4 ÊúâËâ≤Â°äÔºå2 Á©∫ */
.demo-step4 .finish-scene{
  display: grid;
  grid-template-columns: repeat(4, var(--grid-size));
  gap: var(--gap);
  justify-content: center;
  margin: 0 auto;
}

/* Êó¢Êúâ‰∏âÈ°ÜÔºöÁ§∫ÊÑè‰∏äËâ≤ÔºàÂèØÊèõÊàê‰Ω†ÁöÑË™øËâ≤Ôºâ */
.demo-step4 .tile-a { background: #0c6b00; }  /* Á¨¨1Ê†º Á∂† */
.demo-step4 .tile-b { background: #86a927; }  
.demo-step4 .tile-d { background: #ffe14d; }  /* Á¨¨4Ê†º ÈªÉ */

/* Êâã‰∏≠ÈÄô‰∏ÄÈ°ÜÔºàÊúÄÂæå‰∏ÄÈ°ÜÔºâÔºöË∑üÊâãÁßªÂãï */
.demo-step4 .tile-c.floating{
  position: absolute;
  z-index: 3;
  width: var(--grid-size);
  height: var(--grid-size);
  border-radius: var(--grid-radius);
  background: #86a927;
  pointer-events: none;

  /* Âü∫Ê∫ñÔºöÁ¨¨1Ê†ºÂè≥‰∏ãËßíÔºåËµ∑ÈªûÂÜçÂæÄÂ∑¶‰∏ÄÊ†º */
  left: calc(1 * var(--step) + 0 * var(--grid-size));
  top:  calc(0.2 * var(--grid-size));

  /* ‚úÖ ÂñÆ‰∏ÄÂãïÁï´ÂêåÊôÇÁÆ° X+YÔºà‰∏çË¶ÅÂÜçÂàÜÂÖ©ÂÄã transform ÂãïÁï´Ôºâ */
  animation: s4-path $S4_DUR linear infinite;
}

/* ÈÄô‰∫õÁØÄÈªûÁî®‰Ω†ÂâçÈù¢ Step4 ÁöÑÂêåÂêçËÆäÊï∏ */
@keyframes s4-path {
  /* 1) Ëµ∑ÂßãÔºöÂú®Á¨¨1Ê†ºÂ∑¶‰∏ÄÊ†ºÔºåÊâã‰∏≠Ôºà‰∏äÊµÆÁãÄÊÖãÔºâ */
  0%                       { transform: translateX(calc(-1 * var(--step))) translateY(-12px); }
  /* 2) ÁßªÂà∞Á¨¨2Ê†º‰∏äÊñπÔºà‰ªç‰∏äÊµÆÔºâ */
  #{$P_MOVE_END}           { transform: translateX(calc( 1 * var(--step))) translateY(-12px); }
  /* 3) Êîæ‰∏ãÔºöÊéâÈÄ≤Á¨¨‰∫åÊ†ºÔºàÂõûÂà∞ Y=0Ôºâ */
  #{$P_DROP}, #{$P_POP_E}  { transform: translateX(calc( 1 * var(--step))) translateY(0); }
  100%                     { transform: translateX(calc(-1 * var(--step))) translateY(-12px); }
}

/* Ê∏∏Ê®ôÂü∫Ê∫ñÔºöÂêå‰∏ÄÂÄãÂèÉËÄÉÈªûÔºàÁ¨¨1Ê†ºÂè≥‰∏ãËßíÔºåËµ∑ÈªûÂæÄÂ∑¶ 1 Ê†ºÔºâ */

.demo-step4 .cursor-hand {
  position:absolute; 
  z-index:4; 
  pointer-events:none; 
  width:28px;
  left: calc(1 * var(--step) + 0 * var(--grid-size));
  top:  calc(0.2 * var(--grid-size));
  transition: none !important;
  display: block !important; /* Èò≤Ê≠¢ËàäË¶èÂâáÁî® display:none */

  &.idle { 
    animation: 
    s4-cursor-idle $S4_DUR steps(1,end) infinite,
     s4-move $S4_DUR linear infinite !important; 
    } 

  &.grabbing { 
    animation: 
    s4-cursor-grab $S4_DUR steps(1,end) infinite,
     s4-move $S4_DUR linear infinite !important; 
    } 
}









/* idle / grabbingÔºöÁî® opacity ÂàáÊèõÔºàÊîæ‰∏ãÁû¨ÈñìÈ°ØÁ§∫ idleÔºâ */
@keyframes s4-cursor-idle {
  /* (1) Ëµ∑ÂßãÊäìËëó ‚Üí idle=0Ôºõ(3) Êîæ‰∏ãÊôÇÂàª ‚Üí idle=1ÔºõÂÖ∂È§ò 0 */
  0%                         { opacity: 0; }
  #{$P_DROP}, #{$P_POP_E}    { opacity: 1; }
  #{$P_POP_E + 0.01%}, 100%  { opacity: 0; }
}
@keyframes s4-cursor-grab {
  /* ÊäìÂèñÔºöÈô§Êîæ‰∏ãÁû¨ÈñìÂ§ñÈÉΩÁÇ∫ 1 */
  0%                         { opacity: 1; }
  #{$P_DROP}, #{$P_POP_E}    { opacity: 0; }
  #{$P_POP_E + 0.01%}, 100%  { opacity: 1; }
}

/* ===== X ‰ΩçÁΩÆÔºöËµ∑ÈªûÂú®„ÄåÁ¨¨1Ê†ºÁöÑÂ∑¶‰∏ÄÊ†º„ÄçÔºåÁµÇÈªûÂà∞„ÄåÁ¨¨2Ê†º‰∏äÊñπ„Äç ===== */
@keyframes s4-move {
  /* Ëµ∑ÈªûÔºöÂú®Á¨¨1Ê†ºÂ∑¶‰∏ÄÊ†ºÔºà-1 * stepÔºâ */
  0%                          { transform: translateX(calc(-1 * var(--step))); }
  /* (2) ÊäµÈÅîÁ¨¨2Ê†º‰∏äÊñπÔºà+1 * stepÔºâ */
  #{$P_MOVE_END}, #{$P_POP_E} { transform: translateX(calc( 1 * var(--step))); }
  /* (5) ÈáçÁΩÆÁû¨ÈñìÂõûËµ∑ÈªûÔºàÈÅøÂÖçÁúãÂà∞ÂõûÁ®ãÔºâ */
  //99.99%                     { transform: translateX(calc( 1 * var(--step))); }
  100%                        { transform: translateX(calc(-1 * var(--step))); }
}

/* ===== ÊµÆÂãï/ËêΩ‰∏ãÔºöÊâã‰∏≠ÈÇ£È°ÜÂú®Á©∫‰∏≠ ‚Üí Êîæ‰∏ãÂõûÂà∞Ê†ºÂ∫ïÔºàË¶ñË¶∫Ôºâ ===== */
@keyframes s4-float {
  /* Ëµ∑ÂßãÔΩûÂà∞ÈÅîÔºö‰øùÊåÅÊµÆËµ∑Ôºà-12pxÔºâ */
  0%, #{$P_MOVE_END - 0.01%} { transform: translateY(-12px); box-shadow: 0 8px 16px rgba(0,0,0,.35); }
  /* (3) Êîæ‰∏ãÔºöÂõûÂà∞Ê†ºÂ∫ï‰∏¶ÁßªÈô§Èô∞ÂΩ± */
  #{$P_DROP}                 { transform: translateY(0);     box-shadow: none; }
  /* ‰πãÂæåÁ∂≠ÊåÅÂú®Ê†ºÂ∫ïÁõ¥Âà∞ÈáçÁΩÆÔºàÂÖÉÁ¥†ÂêåÊôÇÊúÉË¢´Ê∑°Âá∫Ôºâ */
  #{$P_DROP + 0.01%}, 100%   { transform: translateY(0);     box-shadow: none; }
}

/* ===== Êîæ‰∏ãÁû¨ÈñìÔºöËÆìÊµÆÂãïÈÇ£È°ÜÈö±ËóèÔºàÊïôÂ≠∏Ë¶ñË¶∫ÂÆåÊàêÔºâ ===== */
@keyframes s4-fade-out {
  0%, #{$P_DROP - 0.01%}     { opacity: 1; }
  #{$P_DROP}, 100%           { opacity: 0; }
}

/* ===== ÂÅáÂΩàÁ™óÔºàÊïôÂ≠∏Áî®ÔºâÔºöP_POP_S ~ P_POP_E ÊúüÈñìÈ°ØÁ§∫Ôºå‰πãÂæåËá™ÂãïÈö±Ëóè ===== */
.tutorial-fake-popup{
  opacity: 0;
  pointer-events: none;
  padding: 4vh;
  border-radius: var(--radius);
  width: 95%;

  background: var(--color-gray70);

  text-align: center;
  line-height: 1;


  //margin-top: 12px;
  //padding: 10px 16px;
  //border-radius: 12px;
  //background: var(--color-gray70);
  color: var(--color-gray10);
  font-weight: bold;
  //text-align: center;
  box-shadow: 0 0px 24px rgba(0,0,0,.35);

  animation: s4-popup $S4_DUR steps(1,end) infinite;
}

@keyframes s4-popup {
  0%, #{$P_POP_S - 0.01%}   { opacity: 0; }
  #{$P_POP_S}, #{$P_POP_E}  { opacity: 1; }
  #{$P_POP_E + 0.01%}, 100% { opacity: 0; }
}
