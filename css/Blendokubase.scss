/* ================ reset ================ */

html, body, div, span, applet, object, iframe,
h1, h2, h3, h4, h5, h6, p, blockquote, pre,
a, abbr, acronym, address, big, cite, code,
del, dfn, em, img, ins, kbd, q, s, samp,
small, strike, strong, sub, sup, tt, var,
b, u, i, center,
dl, dt, dd, ol, ul, li,
fieldset, form, label, legend,
table, caption, tbody, tfoot, thead, tr, th, td,
article, aside, canvas, details, embed,
figure, figcaption, footer, header, hgroup,
menu, nav, output, ruby, section, summary,
time, mark, audio, video {
  margin: 0;
  padding: 0;
  border: 0;

  font: inherit;
  font-size: 100%;
  vertical-align: baseline;
}

article, aside, details, figcaption, figure,
footer, header, hgroup, menu, nav, section {
  display: block;
}

body {
  line-height: 1;
}

ol, ul {
  margin: 0;
  padding-left: 32px;
}

blockquote, q { quotes: none; }

blockquote:before, blockquote:after,
q:before, q:after { content: ''; }

table {
  border-collapse: collapse;
  border-spacing: 0;
}

/* ================ tokens ================ */
:root {
  /* frame */
  --radius: 8px;

  --button-size: 32px;
  --button-radius: 8px;
  --button-font-size: 8px;

  --grid-size: 60px;
  --grid-radius: 8px;

  /* text */
  --font-size-h1: 10vh;
  --font-size-h2: 20px;
  --font-size-h3: 14px;
  --font-size-body: 12px;
  --font-size-small: 12px;

  /* color */
  --color-primary: #0a88a3;
  --color-primary2: #004d99;
  --color-primary-light: #39abbd;
  --color-secondary: #ffbf00;
  --color-secondary2: #ffd300;
  --color-warning: #ff80bf;
  --color-temp: #666;

  --color-gray: #5f7791;
  --color-gray90: #202830;
  --color-gray80: #303c49;
  --color-gray70: #3f4f61;
  --color-gray60: #4f6379;
  --color-gray50: #5f7791;
  --color-gray40: #7a8ea3;
  --color-gray30: #94a4b6;
  --color-gray20: #afbbc8;
  --color-gray10: #e4e8ed;
  --color-gray05: #e4e8ed;

  --color-bg-dark: var(--color-gray90);
  --color-container-dark: var(--color-gray70);

  --color-bg-light: #f5f5dc;
  --color-container-light: #264c58;

  --color-border: #5e86c1;

}



// ================ main ================ //

* {
  box-sizing: border-box;
}

html, body {
  overflow: hidden;

  height: 100%;
  margin: 0;

  background: var(--color-bg-dark);
}

.wrap { // border: 1px solid var(--color-temp);
  overflow: hidden;
  position: relative;
  display: flex;
  flex-direction: column;

  max-width: 50vh;
  height: 100vh;
  margin: 0 auto;
  padding: 2vh;

}

button {
  margin: 0 1vh;
  padding: 1vh 3vh;

  border: 0;
  border-radius: var(--radius);
  background: var(--color-gray10);
  cursor: pointer;

  font-size: 2vh;

  color: var(--color-gray90);
}


.hidden { display: none !important; }

// ================ header ================ //
.header{ //border: 1px solid var(--color-temp);
 display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  align-items: center;

  width: 100%;
  height: 8vh;
  margin: 0 auto 2vh;

  background: var(--color-container-dark);
  border-radius: var(--radius);
  
 .logo { // border: 1px solid var(--color-temp);
    width: 4vh;
    height: 4vh;
    margin: 2vh;

    img {
      width: 100%;
      height: auto;
    }
  }

 .levelNum {
    font-family: monospace;
    font-size: 4vh;
    font-weight: bold;
    line-height: 1.5;
    text-align: center;

    color: var(--color-gray20);
  }

}



.icon-btn2{
  background: transparent;
  width: 4vh;
  height: 4vh;
  padding: 0;
  margin: 2vh;
  img {
    width: 100%;
    height: auto;
  }
}

.homeIcon{
  opacity: 0.5;
  cursor: pointer;

  &:hover{opacity: 0.7;}
}


// ================ content ================ //

.panel{
  position: relative;
  display: flex;
  flex-direction: column;
  flex-grow: 1;

  width: 100%;
  margin: 0 auto;
  padding: 4vh;

  background: var(--color-container-dark);
  border-radius: var(--radius);
}

/* ================ panel UI ================ */

.grid-board {
  display: grid;
  justify-content: center;
}

.start-board {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
}

.fixed-tile {
  cursor: not-allowed;
}

.cell {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;

  width: var(--grid-size);
  height: var(--grid-size);

  border: 1px solid var(--color-gray70);
  border-radius: var(--grid-radius);

  background: var(--color-gray90);

  &.fixed::after {//æ”¾ä¸Šä¸Šé–çš„åœ–
    position: absolute;
    top: 4px;
    right: 4px;

    font-size: 14px;

    opacity: 0.7;

    content: "ğŸ”’";
  }
  
  &.hidden-cell {
  background-color: var(--color-container-dark);

  pointer-events: none; /* ç„¡æ³•æ‹–æ›³é€²å…¥ */
  }

}



.tile {
  width: var(--grid-size);
  height: var(--grid-size);

  border-radius: var(--grid-radius);

  cursor: grab;
}



.gap-line {
  height: 2px;
  margin: 4vh 0;

  background: var(--color-gray60);
}

.gap-space {
  flex-grow: 1;

  width: 100%;
}

.info-bar {
  display: flex;
  justify-content: space-between;

  margin-top: 2vh;
  margin-bottom: -1vh;
  padding: 1vh;

  border-radius: var(--radius);
  background: var(--color-gray80);

  font-size: 1.5vh;

  color: var(--color-gray20);
}


.counter {
  display: inline-block;

  width: var(--counter-w, auto);

  text-align: right;
  font-family: monospace;
}

#step-count {
  --counter-w: 30px;
}

#timer {
  --counter-w: 60px;
}

/* ================ Start Screen ================ */
#main-menu {
  position: absolute;
  inset: 2vh;                /* æ¯” top/left/width/height æ›´ç°¡æ½” */
  box-sizing: border-box;
  z-index: 200;         /* æé«˜å±¤ç´šï¼Œç©©ç©©è“‹ä½ä¸€åˆ‡ */

  width: 100%;
  flex-grow: 1;
	margin: 0 auto;
  padding: 4vh;

  background: var(--color-container-dark);
  border-radius: var(--radius);

  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  h1 {color: var(--color-gray10);font-size: var(--font-size-h1);}
  gap: 2vh;

}

/* ä¸»å‹•ä½œåˆ—ï¼šå…©é¡†å¤§æŒ‰éˆ• */
.menu-actions{
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin: 16px 0 20px;
}

/* é—œå¡ 3x3 ç¶²æ ¼ */
.level-grid{
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
}

/* é€šç”¨æŒ‰éˆ• */
.btn {
  //padding: 2vh;
  //border-radius: var(--button-radius);
  //border: 1px solid transparent;
  //text-align: center;
  

  color: var(--color-gray90);
  background: var(--color-gray10);

  &.primary {
  background: var(--color-primary);
  color: var(--color-gray10);
  font-weight: bold;
  
  &:hover{
    background: var(--color-primary-light);
  }
  }

  &.ghost {
  background: transparent;
  border-color: var(--color-gray30);
  color: var(--color-gray20);
  }
  
}


/* é—œå¡æŒ‰éˆ• */
.level-btn{
  padding: 2vh;
  border-radius: var(--button-radius);
  background: var(--color-gray60);
  color: var(--color-gray20);
  font-weight: bold;
}
.level-btn:hover{ background: var(--color-gray50); }
.level-btn:disabled{
  opacity: .5;
  cursor: not-allowed;
}


/* ================ popup ================ */
.popup {
  position: fixed;

  top: 0;
  left: 0;
  width: 100%;
  height: 100%;

  background: rgba(0,0,0,0.4);

  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 100;
}

.popup-content {
  padding: 4vh;
  border-radius: var(--radius);

  background: var(--color-gray70);

  text-align: center;
  line-height: 1;


  h3 {
    color: var(--color-gray10);
    font-size: 3vh;
    line-height: 1.5;
  }

  &.pass-record {
    height: 2vh;
    display: flex;
    justify-content: space-around;
    align-items: center;

    color: var(--color-gray30);
    font-size: 1.5vh; 
  }

}


// ================ footer ================ //
.footer{
  box-sizing: border-box;
  width: 100%;
  height: 4vh;
  margin-top: 2vh;
  padding: 1vh 2vh;
  
	background-color: var(--color-container-dark);
  border-radius: var(--radius);

  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;

	p{
		font-size: 12px;
		color: var(--color-gray40);
		text-align: center;
	}

}

// ================ Overlay shell ================ //

.overlay {
  position: absolute; inset: 0;
  z-index: 300;
  display: flex; align-items: center; justify-content: center;
  background: rgba(0,0,0,.5);
}

.tutorial-card {
  position: absolute;
  inset: 2vh;                /* æ¯” top/left/width/height æ›´ç°¡æ½” */
  box-sizing: border-box;
  z-index: 300;         /* æé«˜å±¤ç´šï¼Œç©©ç©©è“‹ä½ä¸€åˆ‡ */

  width: 100%;
  flex-grow: 1;
	margin: 0 auto;
  padding: 25vh 4vh;

  background: var(--color-container-dark);
  border-radius: var(--radius);
  color: var(--color-gray10);
  display: flex; flex-direction: column; gap: 1.6vh;
}

.tutorial-header { display:flex; justify-content:space-between; align-items:center; margin-bottom: 2vh; }
.tutorial-title { font-size: 2.4vh; font-weight: bold;}
.icon-btn { background: transparent; border: 0; color: var(--color-gray30); font-size: 20px; cursor: pointer; padding:0 ;}

.tutorial-body { min-height: 28vh; }
.t-step { display: none; }
.t-step.active { display: block; }
.t-step h3 { font-size: 2.2vh; margin-bottom: .8vh; color: var(--color-gray10); }
.t-step p  { font-size: 1.6vh; color: var(--color-gray20); margin-bottom: 1.4vh; }

.tutorial-footer { display:flex; justify-content: space-between; align-items:center; }
.dots { display:flex; gap: 8px; }
.dots .dot { width: 8px; height: 8px; border-radius: 50%; background: var(--color-gray50); opacity:.5; }
.dots .dot.active { opacity:1; background: var(--color-secondary); }

.demo { 
  //border: 1px dashed var(--color-gray60);
  border-radius: var(--radius);
  padding: 1.2vh;
}

:root {
  --gap: 8px;
  --grid-size: 60px;
  --grid-radius: 8px; 
  --step: calc(var(--grid-size) + var(--gap));

}

/* å…±ç”¨å°æ ¼ */
.grid { display:grid; grid-template-columns: repeat(3, var(--grid-size)); gap: 8px; justify-content:center; }
.cell {
  display:flex; align-items:center; justify-content:center;
  width: var(--grid-size); height: var(--grid-size);
  background: var(--color-gray90); border: 1px solid var(--color-gray70); border-radius: var(--grid-radius);
}
.cell.empty { background: transparent; border-style: dashed; }
.tile { width: var(--grid-size); height: var(--grid-size); border-radius: var(--grid-radius); }

.demo-panel {
padding: 2vh;

}

.cursor-hand {
  position: absolute;
  transition: none; // ç¦æ­¢ä»»ä½•æ¼¸è®Š
  pointer-events: none; // é˜²æ­¢æ¸¸æ¨™åœ–æ“‹åˆ°äº‹ä»¶
}

/* ===== Step 1 æ•™å­¸æ’åœ–ï¼š2è¡Œ4æ ¼æ¼¸å±¤ç¤ºæ„  ===== */
.demo-gradients {
  display: flex;
  flex-direction: column;
  gap: 3vh; // å…©è¡Œä¹‹é–“é–“è·

  .grid {
    display: flex;
    gap: 0vh; // è‰²å¡Šé–“è·
  }

  // ä¾é †åºå¥—é¡è‰²
  .tile.color1 { background: #0c6b00; }
  .tile.color2 { background: #4d8f13; }
  .tile.color3 { background: #86a927; }
  .tile.color4 { background: #ffe14d; }
  .tile.color5 { background: #004d99; }
  .tile.color6 { background: #007ba7; }
  .tile.color7 { background: #76bad3; }
  .tile.color8 { background: #ebf9ff; }
}

/* ===== Step 2ï¼šæ‹¿èµ·ï¼æ”¾ä¸‹ï¼ç§»å‹•ï¼ˆå®Œæ•´ 1â†’6 æµç¨‹ï¼‰ ===== */


$S2_DUR: 5s;                /* å…¨æ®µå‹•ç•«é•·åº¦ï¼ˆå¯èª¿ï¼‰ */
$S2_MOVE_SLICE: 10%;      /* 5s çš„ 0.5s â‰ˆ 10% */

/* æ™‚é–“ç‰‡æ®µï¼ˆç™¾åˆ†æ¯”ï¼‰ */
$grab1_start: 10%;  $grab1_end: 25%;   /* (2) æŠ“èµ·ä¸­é–“ï¼štile ä¸Šæµ® */
$moveR_start: 40%;  $moveR_end: 48%;   /* (4) å¾€å³ç§» 0.5s */
$grab2_start: 65%;  $grab2_end: 80%;   /* (5) å³æ ¼æŠ“å–ï¼ˆfixedï¼Œä¸ä¸Šæµ®ï¼‰ */
$moveL_start: 90%;  $moveL_end: 98%;   /* (6) å¾€å·¦ç§»å› 0.5s */

.pick-scene {
  --gap: 8px;
  --step: calc(var(--grid-size) + var(--gap)); /* ä¸€æ ¼çš„ä½ç§»è·é›¢ */
  position: relative;                           /* æ¸¸æ¨™å®šä½åƒè€ƒ */
}

/* è®“ä¸‰é¡†ç¤ºæ„è‰²å¡Šå¥½è¾¨è­˜ï¼ˆå¯ä¾ä½ ä¸»é¡Œèª¿æ•´è‰²ï¼‰ */
.pick-t1 { background: var(--color-gray90); }
.pick-t2 { background: #86a927; }
.pick-t3 { background: #ffe14d; }

/* ä¸­é–“é‚£é¡†åœ¨æŠ“å–æœŸé–“ä¸Šæµ®ï¼ˆåªåœ¨ grab1 æœŸé–“ä½œå‹•ï¼‰ */
.pick-scene .mid .tile {
  animation: s2-lift $S2_DUR ease-in-out infinite;
  transform-origin: center;
}
@keyframes s2-lift {
  0%, #{ $grab1_start - 0.01% }     { transform: translateY(0); box-shadow: none; }
  #{$grab1_start}, #{$grab1_end}    { transform: translateY(-12px); box-shadow: 0 8px 16px rgba(0,0,0,.35); }
  #{$grab1_end + 0.01%}, 100%       { transform: translateY(0); box-shadow: none; }
}

/* æ¸¸æ¨™åŸºæº–ä½ç½®ï¼šä¸€é–‹å§‹åœ¨ã€Œä¸­é–“æ ¼ã€å³ä¸‹è§’ */
.pick-scene .cursor-hand {
  position: absolute;
  z-index: 10;                /* æ°¸é æµ®åœ¨ tile ä¹‹ä¸Š */
  width: 28px;
  pointer-events: none;
  left: calc(var(--grid-size) * 3 + var(--gap) * 2 ); /* ä¾ä½ çš„æ ¼æ•¸å¾®èª¿ */
  //top:  calc(0.4 * var(--grid-size));
  transition: none !important; /* ç¦ç”¨ä»»ä½• transition é¿å…æ¼¸è®Š */
}

/* ===== æ¸¸æ¨™ã€Œé¡¯ç¤ºç‹€æ…‹ã€ï¼šç¬åˆ‡ï¼ˆopacity stepsï¼‰ ===== */
/* idleï¼šé™¤äº†å…©æ®µæŠ“å–æœŸé–“å¤–ï¼Œå…¶é¤˜æ™‚æ®µé¡¯ç¤º */
@keyframes s2-cursor-idle {
  0%, #{ $grab1_start - 0.01% }     { opacity: 1; }
  #{$grab1_start}, #{$grab1_end}    { opacity: 0; }   /* æŠ“èµ·ä¸­é–“ */
  #{$grab1_end + 0.01% }, #{ $grab2_start - 0.01% } { opacity: 1; }
  #{$grab2_start}, #{$grab2_end}    { opacity: 0; }   /* å³æ ¼æŠ“å–ï¼ˆfixedï¼‰ */
  #{$grab2_end + 0.01%}, 100%       { opacity: 1; }
}
/* grabbingï¼šèˆ‡ idle äº’è£œ */
@keyframes s2-cursor-grab {
  0%, #{ $grab1_start - 0.01% }     { opacity: 0; }
  #{$grab1_start}, #{$grab1_end}    { opacity: 1; }
  #{$grab1_end + 0.01% }, #{ $grab2_start - 0.01% } { opacity: 0; }
  #{$grab2_start}, #{$grab2_end}    { opacity: 1; }
  #{$grab2_end + 0.01%}, 100%       { opacity: 0; }
}

/* ===== æ¸¸æ¨™ã€Œä½ç½®ã€ï¼šä¸­ â†’ å³ â†’ å›ä¸­ï¼ˆå…©æ®µå„ ~0.5sï¼‰ ===== */
@keyframes s2-move {
  /* èµ·é»åœ¨ä¸­é–“ï¼ˆtranslateX(0)ï¼‰ */
  0%, #{ $moveR_start - 0.01% }     { transform: translateX(0); }
  #{$moveR_end}                     { transform: translateX(var(--step)); } /* å³ç§»ä¸€æ ¼ */
  #{$grab2_end}, #{ $moveL_start - 0.01% } { transform: translateX(var(--step)); }
  #{$moveL_end}                     { transform: translateX(0); }           /* ç§»å›ä¸­é–“ */
  100%                              { transform: translateX(0); }
}

/* å¥—ç”¨åˆ°å…©å¼µæ¸¸æ¨™åœ–ï¼šä¸€å¼µç®¡å¯è¦–ã€ä¸€å¼µç®¡ä¸å¯è¦–ï¼›ä½ç½®å…±ç”¨ s2-move */
.pick-scene .cursor-hand.idle {
  animation: s2-cursor-idle $S2_DUR steps(1, end) infinite,
             s2-move        $S2_DUR linear         infinite;
}
.pick-scene .cursor-hand.grabbing {
  animation: s2-cursor-grab $S2_DUR steps(1, end) infinite,
             s2-move        $S2_DUR linear         infinite;
}




/* ===== Step 3ï¼šäº¤æ›ç¤ºæ„ï¼ˆæ¸¸æ¨™è·¯å¾‘ + A/B äº¤æ›ï¼‰ ===== */

/* ===== Step 3ï¼šå››æ ¼äº¤æ›ï¼ˆåŒæ­¥ + æŠ“å–ç‹€æ…‹ + ç¬åˆ‡é‡ç½®ï¼‰===== */

$S3_DUR: 5s;
$PAUSE_S: (0.5s / $S3_DUR) * 100%;
$PAUSE_L: (0.5s   / $S3_DUR) * 100%;

/* ç¯€é»ï¼ˆå¦‚è¦èª¿é€Ÿåªæ”¹é€™äº›ï¼‰ */
$P1: 10%;         /* èµ·å§‹åœä½ï¼ˆæœªæŠ“ï¼‰ */
$P2: 10.01%;         /* æŠ“1é–‹å§‹ï¼šA ä¸Šæµ® */
$P3: 40%;         /* ç§»å‹• 1â†’3 å®Œæˆ */
$P4: 40.01%;         /* æ”¾ä¸‹åˆ°ç¬¬3æ ¼ */
$P5S: $P4 + $PAUSE_S;   /* ç­‰ 0.5s */
$P5E: $P5S + 0.01%;        /* æŠ“2çµæŸï¼ˆä¸Šæµ®å®Œæˆï¼‰ */
$P6E: 70%;              /* ç§»å‹• 3â†’4 å®Œæˆ */
$P7S: 70%;             /* åœåœ¨ç¬¬4æ ¼ï¼ˆæŠ“è‘—ï¼‰ */
$P7_RELEASE: 70.1%  ; /* 0.5s å¾Œæ”¾ä¸‹ï¼šA è½ç¬¬4ã€B ç¬åˆ°ç¬¬3 */
$RESET_AT: 99.9999%; /* 1s å¾Œé‡ç½®ç¬åˆ‡ */

.demo-step3 .swap-scene{
  --gap: 8px;
  --step: calc(var(--grid-size) + var(--gap));
  display: grid;
  grid-template-columns: repeat(4, var(--grid-size));
  gap: var(--gap);
  justify-content: center;
  position: relative;
}

/* å±¤ç´šï¼šcursor > A > B */
.demo-step3 .tile      { position: relative; z-index: 1; }
.demo-step3 .tile-a    { z-index: 3; will-change: transform; background:#0c6b00; }
.demo-step3 .tile-b    { z-index: 2; background:#ffe14d; }

/* é¿å…èˆŠè¦å‰‡æŠŠä¸€å¼µåœ– display:noneï¼›å…©å¼µéƒ½é¡¯ç¤ºï¼Œç”¨ opacity åˆ‡æ› */
.demo-step3 .cursor-hand { display:block !important; }

/* æ¸¸æ¨™åŸºæº–ï¼ˆç¬¬1æ ¼å³ä¸‹ï¼‰ */
.demo-step3 .cursor-hand{
  position:absolute; z-index:4; pointer-events:none; width:28px;
  left: calc(0 * var(--step) + 1 * var(--grid-size));
  //top:  calc(0.72 * var(--grid-size));
  transition: none !important;
}

/* ===== æ¸¸æ¨™é¡¯ç¤ºç‹€æ…‹ï¼ˆç§»å‹•å…¨ç¨‹ç‚º grabï¼‰===== */
@keyframes s3-cursor-idle {
  /* æœªæŠ“é¡¯ç¤ºï¼ŒæŠ“/ç§»å‹•éš±è— */
  0%, #{$P1}                         { opacity:1; }
  #{$P1 + 0.01%}, #{$P4}             { opacity:0; }   /* æŠ“1 + ç§»å‹•1â†’3 + æ”¾ä¸‹éç¨‹ */
  #{$P4 + 0.01%}, #{$P5S}            { opacity:1; }   /* ç­‰0.5s */
  #{$P5S + 0.01%}, #{$P7_RELEASE}    { opacity:0; }   /* æŠ“2 + ç§»å‹•3â†’4 + æ”¾å‰åœ */
  #{$P7_RELEASE + 0.01%}, 100%       { opacity:1; }
}
@keyframes s3-cursor-grab {
  /* æŠ“èˆ‡ç§»å‹•æœŸé–“é¡¯ç¤º */
  0%, #{$P1}                         { opacity:0; }
  #{$P1 + 0.01%}, #{$P4}             { opacity:1; }   /* æŠ“1 + ç§»å‹•1â†’3 + æ”¾ä¸‹äº¤æ¥ */
  #{$P4 + 0.01%}, #{$P5S}            { opacity:0; }   /* ç­‰0.5s */
  #{$P5S + 0.01%}, #{$P7_RELEASE}    { opacity:1; }   /* æŠ“2 + ç§»å‹•3â†’4 + æ”¾å‰åœ */
  #{$P7_RELEASE + 0.01%}, 100%       { opacity:0; }
}

/* å…©å¼µæ¸¸æ¨™åœ–ï¼šåŒä¸€æ¢ä½ç½®å‹•ç•« + ç·šæ€§ï¼ŒåŒæ­¥ */
.demo-step3 .cursor-hand.idle {
  animation: s3-cursor-idle $S3_DUR steps(1,end) infinite,
             s3-move        $S3_DUR linear       infinite !important;
}
.demo-step3 .cursor-hand.grabbing {
  animation: s3-cursor-grab $S3_DUR steps(1,end) infinite,
             s3-move        $S3_DUR linear       infinite !important;
}

/* ===== æ¸¸æ¨™ä½ç½®ï¼ˆlinearï¼ŒåŒæ­¥ï¼‰ï¼š1â†’3â†’4â†’(99.99%ä»4ï¼Œ100%ç¬å›1) ===== */
@keyframes s3-move {
  /* èµ·é»åœ¨ç¬¬1æ ¼ */
  0%, #{$P2 - 0.01%}                { transform: translateX(0); }

  /* æŠ“èµ·å¾Œç§»å‹•åˆ°ç¬¬3æ ¼ï¼ˆå®Œæˆæ–¼ P3ï¼‰ */
  #{$P3}                            { transform: translateX(calc(2 * var(--step))); }

  /* âœ… åœ¨ç¬¬3æ ¼åœä½ï¼šæ”¾ä¸‹(P4) â†’ ç­‰0.5s(P5S) â†’ æŠ“èµ·å®Œæˆ(P5E) éƒ½ä¸å‹• */
  #{$P4}, #{$P5S}, #{$P5E}          { transform: translateX(calc(2 * var(--step))); }

  /* å†ç§»å‹•åˆ°ç¬¬4æ ¼ï¼ˆå®Œæˆæ–¼ P6Eï¼‰ */
  #{$P6E}                           { transform: translateX(calc(3 * var(--step))); }

  /* åœ¨é‡ç½®å‰åœåœ¨ç¬¬4æ ¼ï¼Œ100% ç¬å›åˆ°ç¬¬1æ ¼ */
  #{$RESET_AT - 0.01%}              { transform: translateX(calc(3 * var(--step))); }
  100%                              { transform: translateX(0); }
}

/* ===== ç¶ è‰² Aï¼šèˆ‡æ¸¸æ¨™åŒç¯€é»ï¼ˆlinearï¼‰ï¼ŒæŠ“æ™‚ä¸Šæµ®ï¼Œæœ€å¾Œç¬åˆ‡å›èµ·é» ===== */
@keyframes s3-a-path {
  0%, #{$P1}                        { transform: translateX(0) translateY(0); box-shadow:none; }

  /* æŠ“1ä¸Šæµ® */
  #{$P2}                            { transform: translateX(0) translateY(-12px); box-shadow:0 8px 16px rgba(0,0,0,.35); }

  /* ç§»å‹• 1â†’3ï¼ˆlinearï¼ŒåŒæ­¥ï¼‰ */
  #{$P3}                            { transform: translateX(calc(2 * var(--step))) translateY(-12px); }

  /* æ”¾ä¸‹åˆ°ç¬¬3æ ¼åº•ä¸¦åœ */
  #{$P4}                            { transform: translateX(calc(2 * var(--step))) translateY(0); box-shadow:none; }
  #{$P5S - 0.01%}                   { transform: translateX(calc(2 * var(--step))) translateY(0); }

  /* æŠ“2ä¸Šæµ®ï¼ˆç¬¬3æ ¼ï¼‰ */
  #{$P5E}                           { transform: translateX(calc(2 * var(--step))) translateY(-12px); box-shadow:none; }

  /* ç§»å‹• 3â†’4ï¼ˆlinearï¼ŒåŒæ­¥ï¼‰ */
  #{$P6E}                           { transform: translateX(calc(3 * var(--step))) translateY(-12px); box-shadow:none; }

  /* æ”¾ä¸‹åˆ°ç¬¬4æ ¼åº•ä¸¦ç¶­æŒåˆ°é‡ç½® */
  #{$P7_RELEASE}                    { transform: translateX(calc(3 * var(--step))) translateY(0); box-shadow:none; }

  /* 99.99% ä»åœ¨ç¬¬4æ ¼ï¼Œ100% ç¬å›ç¬¬1æ ¼ */
  #{$RESET_AT - 0.01%}              { transform: translateX(calc(3 * var(--step))) translateY(0); }
  100%                              { transform: translateX(0) translateY(0); }
}
.demo-step3 .tile-a { animation: s3-a-path $S3_DUR linear infinite !important; }

/* ===== é»ƒè‰² Bï¼šç¬¬7æ­¥ç¬åˆ°ç¬¬3æ ¼ï¼Œé‡ç½®ç¬å›ç¬¬4æ ¼ï¼ˆç”¨ steps ä¿è­‰ç¬åˆ‡ï¼‰ ===== */
@keyframes s3-b-swap {
  0%, #{$P7_RELEASE - 0.01%}        { transform: translateX(0); } /* åœ¨ç¬¬4æ ¼ */
  #{$P7_RELEASE}, #{$RESET_AT - 0.01%} { transform: translateX(calc(-1 * var(--step))); } /* ç¬åˆ°ç¬¬3æ ¼ */
  100%                              { transform: translateX(0); } /* ç¬å›ç¬¬4æ ¼ */
}
.demo-step3 .tile-b { animation: s3-b-swap $S3_DUR steps(1,end) infinite !important; }




/* Step 4 éé—œå‹•ç•« + å‡å½ˆçª— */

/* ===== Step 4ï¼šä¸€é–‹å§‹æ‰‹æŠ“è‘—æœ€å¾Œä¸€é¡† â†’ ç§»åˆ°ç¬¬äºŒæ ¼ä¸Šæ–¹ â†’ æ”¾ä¸‹ â†’ å‡ºç¾å½ˆçª— â†’ é‡ç½® ===== */

$S4_DUR: 4s;                                 /* ğŸ”§ å…¨æ®µç¸½é•· */
//$PAUSE_POP: (1s / $S4_DUR) * 100%;           /* å½ˆçª—é¡¯ç¤º 1s å°æ‡‰çš„ç™¾åˆ†æ¯” */

/* æ™‚é–“ç¯€é»ï¼ˆç™¾åˆ†æ¯”ï¼Œç…§éœ€æ±‚å¥½æ”¹ï¼‰ */
$P_MOVE_END: 40%;         /* (2) ç§»å‹•åˆ°ç¬¬2æ ¼ä¸Šæ–¹ å®Œæˆ */
$P_DROP:      40.01%;        /* (3) æ”¾ä¸‹ï¼ˆtile-c æ‰å…¥ç¬¬2æ ¼ï¼Œæ‰‹æ”¹ idleï¼‰ */
$P_POP_S:     40.01%;        /* (4) å½ˆçª—é¡¯ç¤ºé–‹å§‹ */
$P_POP_E:     99.99%;   /* (4) å½ˆçª—é¡¯ç¤ºçµæŸ */
$P_RESET:     100%;       /* (5) é‡ç½®åˆ°åˆå§‹ */

.demo-step4 {
  position: relative;            /* ä½ å·²ç¶“æœ‰äº†ï¼Œä¿ç•™ */
  --gap: 8px;                    /* æåˆ°é€™è£¡ */
  --step: calc(var(--grid-size) + var(--gap));
}
/* å››æ ¼å ´æ™¯ï¼š1ã€3ã€4 æœ‰è‰²å¡Šï¼Œ2 ç©º */
.demo-step4 .finish-scene{
  display: grid;
  grid-template-columns: repeat(4, var(--grid-size));
  gap: var(--gap);
  justify-content: center;
  margin: 0 auto;
}

/* æ—¢æœ‰ä¸‰é¡†ï¼šç¤ºæ„ä¸Šè‰²ï¼ˆå¯æ›æˆä½ çš„èª¿è‰²ï¼‰ */
.demo-step4 .tile-a { background: #0c6b00; }  /* ç¬¬1æ ¼ ç¶  */
.demo-step4 .tile-b { background: #86a927; }  
.demo-step4 .tile-d { background: #ffe14d; }  /* ç¬¬4æ ¼ é»ƒ */

/* æ‰‹ä¸­é€™ä¸€é¡†ï¼ˆæœ€å¾Œä¸€é¡†ï¼‰ï¼šè·Ÿæ‰‹ç§»å‹• */
.demo-step4 .tile-c.floating{
  position: absolute;
  z-index: 3;
  width: var(--grid-size);
  height: var(--grid-size);
  border-radius: var(--grid-radius);
  background: #86a927;
  pointer-events: none;

  /* åŸºæº–ï¼šç¬¬1æ ¼å³ä¸‹è§’ï¼Œèµ·é»å†å¾€å·¦ä¸€æ ¼ */
  left: calc(1 * var(--step) + 0 * var(--grid-size));
  top:  calc(0.2 * var(--grid-size));

  /* âœ… å–®ä¸€å‹•ç•«åŒæ™‚ç®¡ X+Yï¼ˆä¸è¦å†åˆ†å…©å€‹ transform å‹•ç•«ï¼‰ */
  animation: s4-path $S4_DUR linear infinite;
}

/* é€™äº›ç¯€é»ç”¨ä½ å‰é¢ Step4 çš„åŒåè®Šæ•¸ */
@keyframes s4-path {
  /* 1) èµ·å§‹ï¼šåœ¨ç¬¬1æ ¼å·¦ä¸€æ ¼ï¼Œæ‰‹ä¸­ï¼ˆä¸Šæµ®ç‹€æ…‹ï¼‰ */
  0%                       { transform: translateX(calc(-1 * var(--step))) translateY(-12px); }
  /* 2) ç§»åˆ°ç¬¬2æ ¼ä¸Šæ–¹ï¼ˆä»ä¸Šæµ®ï¼‰ */
  #{$P_MOVE_END}           { transform: translateX(calc( 1 * var(--step))) translateY(-12px); }
  /* 3) æ”¾ä¸‹ï¼šæ‰é€²ç¬¬äºŒæ ¼ï¼ˆå›åˆ° Y=0ï¼‰ */
  #{$P_DROP}, #{$P_POP_E}  { transform: translateX(calc( 1 * var(--step))) translateY(0); }
  100%                     { transform: translateX(calc(-1 * var(--step))) translateY(-12px); }
}

/* æ¸¸æ¨™åŸºæº–ï¼šåŒä¸€å€‹åƒè€ƒé»ï¼ˆç¬¬1æ ¼å³ä¸‹è§’ï¼Œèµ·é»å¾€å·¦ 1 æ ¼ï¼‰ */

.demo-step4 .cursor-hand {
  position:absolute; 
  z-index:4; 
  pointer-events:none; 
  width:28px;
  left: calc(1 * var(--step) + 0 * var(--grid-size));
  top:  calc(0.2 * var(--grid-size));
  transition: none !important;
  display: block !important; /* é˜²æ­¢èˆŠè¦å‰‡ç”¨ display:none */

  &.idle { 
    animation: 
    s4-cursor-idle $S4_DUR steps(1,end) infinite,
     s4-move $S4_DUR linear infinite !important; 
    } 

  &.grabbing { 
    animation: 
    s4-cursor-grab $S4_DUR steps(1,end) infinite,
     s4-move $S4_DUR linear infinite !important; 
    } 
}









/* idle / grabbingï¼šç”¨ opacity åˆ‡æ›ï¼ˆæ”¾ä¸‹ç¬é–“é¡¯ç¤º idleï¼‰ */
@keyframes s4-cursor-idle {
  /* (1) èµ·å§‹æŠ“è‘— â†’ idle=0ï¼›(3) æ”¾ä¸‹æ™‚åˆ» â†’ idle=1ï¼›å…¶é¤˜ 0 */
  0%                         { opacity: 0; }
  #{$P_DROP}, #{$P_POP_E}    { opacity: 1; }
  #{$P_POP_E + 0.01%}, 100%  { opacity: 0; }
}
@keyframes s4-cursor-grab {
  /* æŠ“å–ï¼šé™¤æ”¾ä¸‹ç¬é–“å¤–éƒ½ç‚º 1 */
  0%                         { opacity: 1; }
  #{$P_DROP}, #{$P_POP_E}    { opacity: 0; }
  #{$P_POP_E + 0.01%}, 100%  { opacity: 1; }
}

/* ===== X ä½ç½®ï¼šèµ·é»åœ¨ã€Œç¬¬1æ ¼çš„å·¦ä¸€æ ¼ã€ï¼Œçµ‚é»åˆ°ã€Œç¬¬2æ ¼ä¸Šæ–¹ã€ ===== */
@keyframes s4-move {
  /* èµ·é»ï¼šåœ¨ç¬¬1æ ¼å·¦ä¸€æ ¼ï¼ˆ-1 * stepï¼‰ */
  0%                          { transform: translateX(calc(-1 * var(--step))); }
  /* (2) æŠµé”ç¬¬2æ ¼ä¸Šæ–¹ï¼ˆ+1 * stepï¼‰ */
  #{$P_MOVE_END}, #{$P_POP_E} { transform: translateX(calc( 1 * var(--step))); }
  /* (5) é‡ç½®ç¬é–“å›èµ·é»ï¼ˆé¿å…çœ‹åˆ°å›ç¨‹ï¼‰ */
  //99.99%                     { transform: translateX(calc( 1 * var(--step))); }
  100%                        { transform: translateX(calc(-1 * var(--step))); }
}

/* ===== æµ®å‹•/è½ä¸‹ï¼šæ‰‹ä¸­é‚£é¡†åœ¨ç©ºä¸­ â†’ æ”¾ä¸‹å›åˆ°æ ¼åº•ï¼ˆè¦–è¦ºï¼‰ ===== */
@keyframes s4-float {
  /* èµ·å§‹ï½åˆ°é”ï¼šä¿æŒæµ®èµ·ï¼ˆ-12pxï¼‰ */
  0%, #{$P_MOVE_END - 0.01%} { transform: translateY(-12px); box-shadow: 0 8px 16px rgba(0,0,0,.35); }
  /* (3) æ”¾ä¸‹ï¼šå›åˆ°æ ¼åº•ä¸¦ç§»é™¤é™°å½± */
  #{$P_DROP}                 { transform: translateY(0);     box-shadow: none; }
  /* ä¹‹å¾Œç¶­æŒåœ¨æ ¼åº•ç›´åˆ°é‡ç½®ï¼ˆå…ƒç´ åŒæ™‚æœƒè¢«æ·¡å‡ºï¼‰ */
  #{$P_DROP + 0.01%}, 100%   { transform: translateY(0);     box-shadow: none; }
}

/* ===== æ”¾ä¸‹ç¬é–“ï¼šè®“æµ®å‹•é‚£é¡†éš±è—ï¼ˆæ•™å­¸è¦–è¦ºå®Œæˆï¼‰ ===== */
@keyframes s4-fade-out {
  0%, #{$P_DROP - 0.01%}     { opacity: 1; }
  #{$P_DROP}, 100%           { opacity: 0; }
}

/* ===== å‡å½ˆçª—ï¼ˆæ•™å­¸ç”¨ï¼‰ï¼šP_POP_S ~ P_POP_E æœŸé–“é¡¯ç¤ºï¼Œä¹‹å¾Œè‡ªå‹•éš±è— ===== */
.tutorial-fake-popup{
  opacity: 0;
  pointer-events: none;
  padding: 4vh;
  border-radius: var(--radius);
  width: 95%;

  background: var(--color-gray70);

  text-align: center;
  line-height: 1;


  //margin-top: 12px;
  //padding: 10px 16px;
  //border-radius: 12px;
  //background: var(--color-gray70);
  color: var(--color-gray10);
  font-weight: bold;
  //text-align: center;
  box-shadow: 0 0px 24px rgba(0,0,0,.35);

  animation: s4-popup $S4_DUR steps(1,end) infinite;
}

@keyframes s4-popup {
  0%, #{$P_POP_S - 0.01%}   { opacity: 0; }
  #{$P_POP_S}, #{$P_POP_E}  { opacity: 1; }
  #{$P_POP_E + 0.01%}, 100% { opacity: 0; }
}
